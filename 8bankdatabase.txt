8. Create the bank database with the following table:
1. branch_master(branch_id, bname) branch_id is primary key
2. employee_master(emp_no, e_name, branch_id, salary, dept, manager_id) emp_no primary key, branch id foreign key, manager_id foreign key on delete set null
3. contact details (empid, emailid, phnno) emp_id forieign key and apply on delete set null constraint on emp_id
4. emp_address_details(emp_id, street, city, state) apply a foreign on emp_id also apply on delete cascade constraint
5. branch_address(branch_id, city, state) branch_id is foreign key
Insert 5 records in each table
Queries:
1) List the employee details along with the branch name using inner join and in order of employee no.
2) List the employee's name with the contact details if have or not have any. //delete first 2 emp from emp_master
3) Retrive the employee's name and their respective manager's name.
4) List the employee details along with the branch name using natural join.
5) Find the employee who works at vadgaon branch with salaries more than 10000 and list the employee names with the streets and city they live in.
6) Create a view which will show the avg salary and the total salary at each branch.



-- Create and use the database
CREATE DATABASE bankdb8;
USE bankdb8;

-- 1. Branch master
CREATE TABLE branch_master (
  branch_id INT PRIMARY KEY,
  bname     VARCHAR(100) NOT NULL
);

-- 5. Branch address (FK to branch_master)
CREATE TABLE branch_address (
  branch_id INT,
  city      VARCHAR(100),
  state     VARCHAR(100),
  CONSTRAINT fk_branch_addr_branch
    FOREIGN KEY (branch_id) REFERENCES branch_master(branch_id)
);

-- 2. Employee master (self-FK manager_id with ON DELETE SET NULL)
CREATE TABLE employee_master (
  emp_no     INT PRIMARY KEY,
  e_name     VARCHAR(100) NOT NULL,
  branch_id  INT,
  salary     DECIMAL(10,2),
  dept       VARCHAR(100),
  manager_id INT NULL,
  CONSTRAINT fk_emp_branch
    FOREIGN KEY (branch_id) REFERENCES branch_master(branch_id),
  CONSTRAINT fk_emp_manager
    FOREIGN KEY (manager_id) REFERENCES employee_master(emp_no)
    ON DELETE SET NULL
);

-- 3. Contact details (emp_id FK ON DELETE SET NULL)
CREATE TABLE contact_details (
  emp_id  INT NULL,
  emailid VARCHAR(150),
  phnno   VARCHAR(20),
  CONSTRAINT fk_contact_emp
    FOREIGN KEY (emp_id) REFERENCES employee_master(emp_no)
    ON DELETE SET NULL
);

-- 4. Employee address details (emp_id FK ON DELETE CASCADE)
CREATE TABLE emp_address_details (
  emp_id INT,
  street VARCHAR(200),
  city   VARCHAR(100),
  state  VARCHAR(100),
  CONSTRAINT fk_addr_emp
    FOREIGN KEY (emp_id) REFERENCES employee_master(emp_no)
    ON DELETE CASCADE
);






-- Branches (include 'Vadgaon')
INSERT INTO branch_master (branch_id, bname) VALUES
(1, 'Vadgaon'),
(2, 'Kothrud'),
(3, 'Shivajinagar'),
(4, 'Hinjewadi'),
(5, 'Pune Camp');

-- Branch addresses
INSERT INTO branch_address (branch_id, city, state) VALUES
(1, 'Pune', 'Maharashtra'),
(2, 'Pune', 'Maharashtra'),
(3, 'Pune', 'Maharashtra'),
(4, 'Pune', 'Maharashtra'),
(5, 'Pune', 'Maharashtra');

-- Employees (set managers so FKs resolve)
INSERT INTO employee_master (emp_no, e_name, branch_id, salary, dept, manager_id) VALUES
(1001, 'Asha',    1, 12000.00, 'Loans',     NULL),   -- Manager at Vadgaon
(1002, 'Bharat',  1,  9000.00, 'Teller',    1001),
(1003, 'Chetan',  2, 15000.00, 'Manager',   NULL),   -- Manager at Kothrud
(1004, 'Deepa',   3, 11000.00, 'Teller',    1003),
(1005, 'Eshan',   1, 20000.00, 'Manager',   1001);

-- Contacts (some employees without contact to test LEFT JOIN)
INSERT INTO contact_details (emp_id, emailid, phnno) VALUES
(1001, 'asha@bank.com',   '9876500010'),
(1003, 'chetan@bank.com', '9876500030'),
(1005, 'eshan@bank.com',  '9876500050'),
(1004, NULL,              NULL),
(NULL, 'info@bank.com',   '1800123456');  -- orphan info row (emp_id NULL)

-- Employee addresses
INSERT INTO emp_address_details (emp_id, street, city, state) VALUES
(1001, '12 MG Road',            'Pune', 'Maharashtra'),
(1002, '5 FC Lane',             'Pune', 'Maharashtra'),
(1003, '44 Karve Nagar',        'Pune', 'Maharashtra'),
(1004, '9 Law College Road',    'Pune', 'Maharashtra'),
(1005, '101 Paud Phata',        'Pune', 'Maharashtra');





SELECT e.emp_no, e.e_name, e.branch_id, b.bname, e.salary, e.dept, e.manager_id
FROM employee_master e
INNER JOIN branch_master b ON b.branch_id = e.branch_id
ORDER BY e.emp_no;




SELECT e.emp_no, e.e_name, c.emailid, c.phnno
FROM employee_master e
LEFT JOIN contact_details c ON c.emp_id = e.emp_no
ORDER BY e.emp_no;




DELETE FROM employee_master WHERE emp_no IN (1001, 1002);

-- Effects:
--   contact_details.emp_id for 1001/1002 -> set to NULL (ON DELETE SET NULL)
--   emp_address_details rows for 1001/1002 -> deleted (ON DELETE CASCADE)
--   manager_id pointing to 1001/1002 -> becomes NULL (ON DELETE SET NULL)



SELECT e.emp_no, e.e_name AS employee, m.e_name AS manager
FROM employee_master e
LEFT JOIN employee_master m ON m.emp_no = e.manager_id
ORDER BY e.emp_no;



SELECT e.emp_no, e.e_name, e.salary, e.dept, b.bname
FROM employee_master e
NATURAL JOIN branch_master b
ORDER BY e.emp_no;



SELECT e.e_name,
       a.street,
       a.city
FROM employee_master e
JOIN branch_master b   ON b.branch_id = e.branch_id
JOIN emp_address_details a ON a.emp_id = e.emp_no
WHERE b.bname = 'Vadgaon'
  AND e.salary > 10000;




CREATE OR REPLACE VIEW v_branch_salary_stats AS
SELECT b.branch_id,
       b.bname,
       AVG(e.salary)  AS avg_salary,
       SUM(e.salary)  AS total_salary,
       COUNT(e.emp_no) AS employee_count
FROM branch_master b
LEFT JOIN employee_master e ON e.branch_id = b.branch_id
GROUP BY b.branch_id, b.bname;

-- See the view:
SELECT * FROM v_branch_salary_stats ORDER BY branch_id;





